import pandas as pd
import matplotlib.pyplot as plt
from matplotlib.colors import ListedColormap

from sklearn.neighbors import KNeighborsClassifier
from sklearn.preprocessing import StandardScaler
from tools import *


def Q1_final():

    #Labeling the data Columns

    #Importing and labeling training data
    df_train_sNC=pd.read_csv('Data/train.sNC.csv', header=None)
    df_train_sNC.columns=Global.columns_names
    df_train_sNC[Global.label_name]=Global.sNC_label

    df_train_sDAT=pd.read_csv('Data/train.sDAT.csv', header=None)
    df_train_sDAT.columns=Global.columns_names
    df_train_sDAT[Global.label_name]=Global.sDAT_label

    #joining all the training data
    df_train=pd.concat([df_train_sNC, df_train_sDAT], axis=0, ignore_index=True)

    #Importing and labeling testing data
    df_test_sNC=pd.read_csv('Data/test.sNC.csv', header=None)
    df_test_sNC.columns=Global.columns_names
    df_test_sNC[Global.label_name]=Global.sNC_label

    df_test_sDAT=pd.read_csv('Data/test.sDAT.csv', header=None)
    df_test_sDAT.columns=Global.columns_names
    df_test_sDAT[Global.label_name]=Global.sDAT_label

    #joining all the testing data
    df_test=pd.concat([df_test_sNC, df_test_sDAT], axis=0, ignore_index=True)

    k_values=[1,3,5,10,20,30,50,100,150,200]

    #Conflict Region Range
    # x1_range=(1.2, 1.6)
    # x2_range=(1.3, 1.8)

    skip=3

    df_test_sNC=df_test_sNC.iloc[::skip]
    df_test_sDAT=df_test_sDAT.iloc[::skip]
    df_train_sNC=df_train_sNC.iloc[::skip]
    df_train_sDAT=df_train_sDAT.iloc[::skip]

    x1_range=(min(df_test_sDAT.iloc[:,0].min(), df_train_sDAT.iloc[:,0].min())-0.1,
                  max(df_test_sNC.iloc[:,0].max(), df_train_sNC.iloc[:,0].max())+0.1)
    x2_range=(min(df_test_sDAT.iloc[:,1].min(), df_train_sDAT.iloc[:,1].min()-0.1),
                  max(df_test_sNC.iloc[:,1].max(), df_train_sNC.iloc[:,1].max())+0.1)
    step=0.002

#    result_list=[]

    for k in k_values:
        knn, scaler, err_train = train_kNN(df_train, k)
        err_test=test_kNN(df_test, knn, scaler)

        # row = {'k Value': k, 'Training Error': err_train, 'Test Error': err_test}
        # result_list.append(row)


        plt.xlabel(r'$x_1$')
        plt.ylabel(r'$x_2$')
        plt.xlim(x1_range)
        plt.ylim(x2_range)


        plot_decision_region(knn, scaler, x1_range, x2_range, step)

        plt.scatter(df_train_sNC.iloc[:,0], df_train_sNC.iloc[:,1],
                        color=Global.sNC_color,marker='o', label='0/sNC train')
        plt.scatter(df_train_sDAT.iloc[:,0], df_train_sDAT.iloc[:,1],
                        color=Global.sDAT_color,marker='o', label='1/sDAT train')

        plt.scatter(df_test_sNC.iloc[:,0], df_test_sNC.iloc[:,1],
                        color=Global.sNC_color,marker='x', label='0/sNC test')
        plt.scatter(df_test_sDAT.iloc[:,0], df_test_sDAT.iloc[:,1],
                        color=Global.sDAT_color,marker='x', label='1/sDAT test')

        title = "kNN Decision Boydary for k=30, err_train = " + str(round(err_train, 3)) + " Err_test = " + str(round(err_test, 3)) + " \n ploted skipping every " + str(skip) + " points \n Regions labeled by color, green = 0/sNC, blue = 1s/DAT"
        plt.title(title, fontsize=10)

        plt.legend(loc='upper left')

        #plt.savefig('Q1/ZoomedOut/knn_nozoom_k'+str(k)+'.pdf', bbox_inches='tight')
        plt.savefig('Q1_graphs/knn_k'+str(k)+'.png', dpi=300)
        plt.close('all')

    print("Graphs saved on the Q1_graphs/ folder")






Q1_final()
